<div class="container mb-5">
    <h2 class="p-2">Teklifleri Karşılaştır</h2>
    <div class="grid">
    @for(bid of bids; track bid.id; let i=$index) {
        <div class="col">
           <strong> Teklif {{i+1}} : </strong> <br/>
            <strong> Firma Adı: </strong> {{bid.company_name}} <br/> 
           <strong>Teklif no: </strong> {{bid.id}} <br/>
        </div>
    }
</div>
</div>
@if(tableData) {
    <p-menubar [model]="tableMenuItems" styleClass="sticky">
        <ng-template pTemplate="end">
          <div class="flex align-items-center gap-2">
            <p-multiSelect 
            display="chip" 
            [options]="compareColumns" 
            [(ngModel)]="selectedColumns" 
            (ngModelChange)="colReorder()"
            optionLabel="header"
            [style]="{'min-width': '200px'}" 
            placeholder="Gösterilecek Sütunları Seçiniz" />
        </div>
      </ng-template>
      </p-menubar>
<div class="card">
    <p-table [value]="tableData" [columns]="selectedColumns"  [reorderableColumns]="true" [tableStyle]="tableStyle" styleClass="p-datatable-striped p-datatable-sm"
    >
        <ng-template pTemplate="caption">
           @if(markMin) {
            <p-toggleButton 
            [(ngModel)]="markMin" 
            (ngModelChange)="unMarkAll(tableData,compareColumns)"
            onLabel="Minimum Değerler" 
            offLabel="Minimum Değerler" 
            onIcon="pi pi-check" 
            offIcon="pi pi-times" 
            styleClass="text-xs mx-2"
            ariaLabel="Miniumları İşaretle"
             styleClass="" />
           }
                
        </ng-template>
        <ng-template pTemplate="header" let-compareColumns>
            <tr>
                @for(column of columns; track column; let i =$index) {
                    @if(column.isBirim || column.isToplam) {
                        <th [attr.colspan]="bids.length+colExpandValue"> {{column.header}} </th>
                    }
                    @else {
                         <!-- <th [pSortableColumn]="column.field">{{ i===0 ?  'Poz No' : column.header }}  
                            <p-sortIcon [field]="column.field"></p-sortIcon>
                        </th>  -->
                        <th colspan="1" > </th>
                    }
                    
                }
            </tr>
            <tr>
               @for(col of compareColumns; track col; ) {
                <th pReorderableColumn [ngClass]="col.color ? col.color : ''"> {{ col.header}}</th>
               }
            </tr>
            
        </ng-template>
        
        <ng-template pTemplate="body" let-row let-columns="compareColumns">
            
            <tr>
                @for(col of selectedColumns; track col) {
                    
                        <td [ngClass]="[row[col.field+'mark'] ? row[col.field+'mark'] : col.color ? col.color : '' ]"> {{row[col.field]}} </td>
                   
                }
            </tr>
        </ng-template>
    </p-table>
</div>
 
}
